import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as h,j as t,c as O,R as A}from"./client-DMp2t5-j.js";const J=new TextDecoder,F=new TextEncoder;function $(e,s){const a=F.encode(e);if(a.length<=s)return e;const o=a.slice(0,s);return`${J.decode(o)}
… (kısaltıldı)`}function y(e){try{const s=JSON.parse(e);return{text:JSON.stringify(s,null,2),isValid:!0}}catch{return{text:e,isValid:!1}}}function U(e){const s=["curl","-X",e.method];for(const a of e.requestHeaders||[]){const o=a.name.replace(/\s+/g," "),n=a.value.replace(/\s+/g," ");s.push("-H",`'${o}: ${n}'`)}return e.requestBody&&s.push("--data",`'${e.requestBody.replace(/'/g,"'\\''")}'`),s.push(`'${e.url}'`),s.join(" ")}function X(e){const s={};for(const a of e)s[a.name.toLowerCase()]=a.value;return s}function S(e,s){if(!e||s==="base64")return!1;const a=e.toLowerCase();return a.startsWith("text/")||a.includes("application/json")||a.includes("application/xml")||a.includes("application/javascript")||a.includes("application/xhtml+xml")}function I(e){var s;if(e.time&&((s=e.response)!=null&&s.receivedTime))return Math.max(0,(e.response.receivedTime-e.time)*1e3);if(e.timings){const a=e.timings,o=[a.blocked,a.dns,a.connect,a.send,a.wait,a.receive,a.ssl].filter(n=>typeof n=="number"&&n>=0);if(o.length>0)return o.reduce((n,c)=>n+c,0)}}function j(e){return e?e.map(s=>({name:s.name||"",value:s.value||""})):[]}const Y=200,L=200*1024,b="apiMonitorLogs",z={items:[],filter:{text:"",onlyErrors:!1,onlyXhr:!1,onlyApi:!1},selectedId:void 0,activeTab:"request"};function _(e,s){switch(s.type){case"setItems":return{...e,items:s.items};case"addItem":{const a=[s.item,...e.items].slice(0,Y);return{...e,items:a}}case"setFilter":return{...e,filter:{...e.filter,...s.filter}};case"setSelected":return{...e,selectedId:s.id};case"setTab":return{...e,activeTab:s.tab};case"clear":return{...e,items:[],selectedId:void 0};default:return e}}function V(e){return new Date(e).toLocaleTimeString([],{hour12:!1})}function E(e){return e===void 0?"-":`${Math.round(e)}`}function M(e){return e.length===0?"(yok)":e.map(s=>`${s.name}: ${s.value}`).join(`
`)}async function G(e){var d,m,f;const s=j((d=e.response)==null?void 0:d.headers),a=X(s),o=((f=(m=e.response)==null?void 0:m.content)==null?void 0:f.mimeType)||a["content-type"],{content:n,encoding:c}=await new Promise(u=>{try{e.getContent((r,i)=>{u({content:r??void 0,encoding:i})})}catch{u({})}});if(!n||!S(o,c)){const u=!!n||(o?!S(o,c):!1);return{mimeType:o,unreadable:u}}return{mimeType:o,body:$(n,L),unreadable:!1}}function Z(e){const s=e;return(s.type||s._resourceType||"").toString()}function K(){const[e,s]=h.useReducer(_,z),a=h.useRef(!1);h.useEffect(()=>{chrome.storage.session.get([b],r=>{const i=r[b]||[];s({type:"setItems",items:i}),a.current=!0})},[]),h.useEffect(()=>{a.current&&chrome.storage.session.set({[b]:e.items})},[e.items]),h.useEffect(()=>{const r=async i=>{var v,k,g,T,w,N,C,R;const p=j((v=i.request)==null?void 0:v.headers),l=j((k=i.response)==null?void 0:k.headers),D=(T=(g=i.request)==null?void 0:g.postData)!=null&&T.text?$(i.request.postData.text,L):void 0,x=await G(i),H={id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,timeMs:i.time?Math.round(i.time*1e3):Date.now(),method:((w=i.request)==null?void 0:w.method)||"",url:((N=i.request)==null?void 0:N.url)||"",status:((C=i.response)==null?void 0:C.status)||0,statusText:(R=i.response)==null?void 0:R.statusText,requestHeaders:p,responseHeaders:l,requestBody:D,responseBody:x.body,responseMimeType:x.mimeType,responseUnreadable:x.unreadable,durationMs:I(i),resourceType:Z(i),timings:i.timings};s({type:"addItem",item:H})};return chrome.devtools.network.onRequestFinished.addListener(r),()=>{chrome.devtools.network.onRequestFinished.removeListener(r)}},[]);const o=h.useMemo(()=>{const r=e.filter.text.trim().toLowerCase();return e.items.filter(i=>{if(e.filter.onlyErrors&&i.status<400||e.filter.onlyApi&&!i.url.toLowerCase().includes("/api"))return!1;if(e.filter.onlyXhr){const l=(i.resourceType||"").toLowerCase();if(!l.includes("xhr")&&!l.includes("fetch"))return!1}return r?`${i.method} ${i.url} ${i.status}`.toLowerCase().includes(r):!0})},[e.items,e.filter]),n=e.items.find(r=>r.id===e.selectedId),c=n!=null&&n.requestBody?y(n.requestBody):null,d=n!=null&&n.responseBody?y(n.responseBody):null,m=async()=>{n&&await navigator.clipboard.writeText(U(n))},f=async()=>{n!=null&&n.responseBody&&await navigator.clipboard.writeText(y(n.responseBody).text)},u=()=>{const r=JSON.stringify(e.items,null,2),i=new Blob([r],{type:"application/json"}),p=URL.createObjectURL(i),l=document.createElement("a");l.href=p,l.download=`api-monitor-${Date.now()}.json`,l.click(),URL.revokeObjectURL(p)};return t.jsxs("div",{className:"app",children:[t.jsxs("div",{className:"main",children:[t.jsxs("div",{className:"toolbar",children:[t.jsx("div",{className:"title",children:"API İzleyici"}),t.jsx("input",{type:"text",placeholder:"Ara (URL, endpoint, içerik)...",value:e.filter.text,onChange:r=>s({type:"setFilter",filter:{text:r.target.value}})}),t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:e.filter.onlyErrors,onChange:r=>s({type:"setFilter",filter:{onlyErrors:r.target.checked}})}),"Sadece Hatalar (>= 400)"]}),t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:e.filter.onlyXhr,onChange:r=>s({type:"setFilter",filter:{onlyXhr:r.target.checked}})}),"Sadece XHR/Fetch"]}),t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:e.filter.onlyApi,onChange:r=>s({type:"setFilter",filter:{onlyApi:r.target.checked}})}),"Sadece /api"]}),t.jsx("button",{className:"primary",onClick:u,children:"Dışa Aktar (JSON)"}),t.jsx("button",{onClick:()=>s({type:"clear"}),children:"Temizle"})]}),t.jsx("div",{className:"table-wrap",children:o.length===0?t.jsx("div",{className:"empty",children:"Henüz kayıt yok. DevTools açıkken yapılan istekler burada listelenir."}):t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Zaman"}),t.jsx("th",{children:"Metot"}),t.jsx("th",{children:"Durum"}),t.jsx("th",{children:"URL"}),t.jsx("th",{children:"Süre (ms)"})]})}),t.jsx("tbody",{children:o.map(r=>t.jsxs("tr",{onClick:()=>s({type:"setSelected",id:r.id}),children:[t.jsx("td",{children:V(r.timeMs)}),t.jsx("td",{children:r.method}),t.jsx("td",{children:t.jsx("span",{className:`badge ${r.status>=400?"error":"success"}`,children:r.status||"-"})}),t.jsx("td",{children:r.url}),t.jsx("td",{children:E(r.durationMs)})]},r.id))})]})})]}),t.jsx("div",{className:"drawer",children:n?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"drawer-header",children:[t.jsxs("h2",{children:[n.method," ",n.status||""]}),t.jsx("div",{className:"meta",children:n.url})]}),t.jsxs("div",{className:"tabs",children:[t.jsx("button",{className:e.activeTab==="request"?"active":"",onClick:()=>s({type:"setTab",tab:"request"}),children:"İstek"}),t.jsx("button",{className:e.activeTab==="response"?"active":"",onClick:()=>s({type:"setTab",tab:"response"}),children:"Yanıt"}),t.jsx("button",{className:e.activeTab==="headers"?"active":"",onClick:()=>s({type:"setTab",tab:"headers"}),children:"Başlıklar"}),t.jsx("button",{className:e.activeTab==="timing"?"active":"",onClick:()=>s({type:"setTab",tab:"timing"}),children:"Zamanlama"})]}),t.jsxs("div",{className:"drawer-content",children:[e.activeTab==="request"&&t.jsxs("div",{children:[c?c.text:"İstek gövdesi yok.",c&&!c.isValid&&t.jsx("div",{children:"Geçerli JSON değil."})]}),e.activeTab==="response"&&t.jsxs("div",{children:[n.responseUnreadable?"İçerik okunamadı (binary/çok büyük olabilir).":d?d.text:"Yanıt gövdesi yok.",d&&!d.isValid&&t.jsx("div",{children:"Geçerli JSON değil."})]}),e.activeTab==="headers"&&t.jsx("div",{children:`İstek başlıkları:
${M(n.requestHeaders)}

Yanıt başlıkları:
${M(n.responseHeaders)}`}),e.activeTab==="timing"&&t.jsx("div",{children:`Süre: ${E(n.durationMs)} ms

Zamanlama:
${JSON.stringify(n.timings||{},null,2)}`})]}),t.jsxs("div",{className:"actions",children:[t.jsx("button",{onClick:m,children:"cURL olarak kopyala"}),t.jsx("button",{onClick:f,children:"Yanıt JSON'unu kopyala"})]})]}):t.jsx("div",{className:"empty",children:"Detay için bir kayıt seçin."})})]})}const B=document.getElementById("root");if(!B)throw new Error("Kök eleman bulunamadı");O(B).render(t.jsx(A.StrictMode,{children:t.jsx(K,{})}));
